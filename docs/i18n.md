# 国际化 (i18n) 配置说明

本项目已配置支持中英文双语切换功能。

## 技术栈

- **next-intl**: Next.js 15+ App Router 推荐的国际化解决方案
- **支持语言**: 
  - 英文 (en) - 默认语言
  - 中文 (zh)

## 项目结构

```
learning_nextjs_again/
├── app/
│   ├── [locale]/           # 动态语言路由
│   │   ├── layout.tsx      # 语言布局包装器
│   │   └── page.tsx        # 首页（支持多语言）
│   └── globals.css
├── components/
│   └── LanguageSwitcher.tsx # 语言切换组件
├── i18n/
│   ├── config.ts           # 语言配置
│   ├── request.ts          # Next-intl 请求配置
│   └── routing.ts          # 路由配置和导航工具
├── messages/
│   ├── en.json             # 英文翻译
│   └── zh.json             # 中文翻译
└── middleware.ts           # 语言路由中间件
```

## 使用方法

### 1. 访问不同语言版本

- 英文版: `http://localhost:3000/en`
- 中文版: `http://localhost:3000/zh`
- 根路径: `http://localhost:3000/` (自动重定向到默认语言 `/en`)

### 2. 在组件中使用翻译

#### Server Component（服务端组件）

```tsx
import { useTranslations } from 'next-intl';

export default function MyComponent() {
  const t = useTranslations('HomePage');
  
  return <h1>{t('title')}</h1>;
}
```

#### Client Component（客户端组件）

```tsx
'use client';

import { useTranslations } from 'next-intl';

export default function MyClientComponent() {
  const t = useTranslations('HomePage');
  
  return <button>{t('buttonText')}</button>;
}
```

### 3. 添加新的翻译

在 `messages/en.json` 和 `messages/zh.json` 中添加对应的键值对：

**messages/en.json**
```json
{
  "HomePage": {
    "title": "Welcome"
  }
}
```

**messages/zh.json**
```json
{
  "HomePage": {
    "title": "欢迎"
  }
}
```

### 4. 使用国际化导航

从 `@/i18n/routing` 导入导航工具，而不是直接使用 Next.js 的：

```tsx
import { Link, useRouter, usePathname } from '@/i18n/routing';

// 使用 Link 组件（会自动包含当前语言）
<Link href="/about">About</Link>

// 使用 useRouter
const router = useRouter();
router.push('/about');

// 获取路径名（不包含语言前缀）
const pathname = usePathname();
```

### 5. 语言切换

项目已包含 `LanguageSwitcher` 组件，可以直接使用：

```tsx
import LanguageSwitcher from '@/components/LanguageSwitcher';

export default function Header() {
  return (
    <header>
      <LanguageSwitcher />
    </header>
  );
}
```

## 配置说明

### 修改默认语言

编辑 `i18n/routing.ts`:

```typescript
export const routing = defineRouting({
  locales: ['en', 'zh'],
  defaultLocale: 'zh', // 改为中文作为默认语言
  localePrefix: 'always'
});
```

### 添加新语言

1. 在 `messages/` 目录添加新的语言文件，如 `ja.json` (日语)
2. 更新 `i18n/routing.ts`:

```typescript
export const routing = defineRouting({
  locales: ['en', 'zh', 'ja'], // 添加新语言
  defaultLocale: 'en',
  localePrefix: 'always'
});
```

3. 更新 `middleware.ts` 的 matcher:

```typescript
export const config = {
  matcher: ['/', '/(zh|en|ja)/:path*'] // 添加新语言
};
```

## 最佳实践

1. **翻译文件组织**: 按功能模块组织翻译键，如 `HomePage`、`AboutPage`、`Common` 等
2. **翻译键命名**: 使用有意义的驼峰命名，如 `buttonSubmit` 而不是 `btn1`
3. **默认值**: 始终为所有支持的语言提供翻译，避免缺失键
4. **类型安全**: 考虑使用 TypeScript 为翻译键生成类型定义

## 开发和构建

```bash
# 开发模式
pnpm dev

# 构建生产版本
pnpm build

# 启动生产服务器
pnpm start
```

## 常见问题

### Q: 为什么访问 `/` 会重定向到 `/en`？

A: 这是 middleware 的默认行为，会自动重定向到默认语言。可以在 `i18n/routing.ts` 中修改 `localePrefix` 配置。

### Q: 如何在 metadata 中使用翻译？

A: 在 layout.tsx 或 page.tsx 中导出 `generateMetadata` 函数：

```tsx
import { getTranslations } from 'next-intl/server';

export async function generateMetadata({ params }) {
  const { locale } = await params;
  const t = await getTranslations({ locale, namespace: 'HomePage' });
  
  return {
    title: t('title'),
    description: t('description')
  };
}
```

### Q: 如何获取当前语言？

A: 使用 `useLocale()` hook：

```tsx
import { useLocale } from 'next-intl';

const locale = useLocale(); // 'en' 或 'zh'
```

